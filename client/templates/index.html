<!DOCTYPE html>
<html>
<head>
    <title>STT 테스트 클라이언트</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .status { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            white-space: pre-line;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        .status.success { background-color: #d4edda; color: #155724; border-left: 4px solid #28a745; }
        .status.error { background-color: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
        input[type="file"], input[type="text"] { margin: 10px 0; padding: 5px; }
        button { padding: 10px 20px; margin: 5px; background-color: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        #result { margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1>STT 테스트 클라이언트</h1>
        
        <div class="section">
            <h3>서버 상태</h3>
            <div id="serverStatus" class="status">확인 중...</div>
            <button onclick="checkServer()">서버 연결 확인</button>
            <button onclick="getServiceInfo()">서비스 정보</button>
        </div>
        
        <div class="section">
            <h3>음성 파일 업로드</h3>
            <input type="file" id="audioFile" accept=".wav,.mp3,.m4a,.flac,.ogg">
            <button onclick="transcribeFile()">음성 변환</button>
        </div>
        
        <div class="section">
            <h3>파일 경로 입력</h3>
            <input type="text" id="filePath" placeholder="음성 파일 경로를 입력하세요" style="width: 100%;">
            <button onclick="transcribeByPath()">경로로 변환</button>
        </div>
        
        <div class="section">
            <h3>변환 결과</h3>
            <div id="result">결과가 여기에 표시됩니다.</div>
        </div>
    </div>
    
    <script>
        function checkServer() {
            const statusDiv = document.getElementById('serverStatus');
            statusDiv.textContent = '확인 중...';
            statusDiv.className = 'status';
            
            fetch('http://localhost:7920/api/v1/health')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'healthy') {
                        const statusText = 
                            '서버 연결됨\n' +
                            '   모델 상태: ' + (data.model_loaded ? '로드됨' : '로드 안됨') + '\n' +
                            '   서비스: ' + (data.service || 'N/A') + '\n' +
                            '   응답 시간: ' + (data.timestamp ? new Date(data.timestamp).toLocaleString() : 'N/A');
                        statusDiv.textContent = statusText;
                        statusDiv.className = 'status success';
                    } else {
                        statusDiv.textContent = '서버 상태 이상';
                        statusDiv.className = 'status error';
                    }
                })
                .catch(error => {
                    statusDiv.textContent = '서버 연결 실패\n   오류: ' + error.message;
                    statusDiv.className = 'status error';
                });
        }
        
        function transcribeFile() {
            const fileInput = document.getElementById('audioFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('파일을 선택하세요.');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            document.getElementById('result').textContent = '변환 중...';
            
            fetch('http://localhost:7920/api/v1/transcribe', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('result').textContent = '오류: ' + data.error;
                } else {
                    let resultText = 
                        '변환 결과\n' +
                        '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n' +
                        '텍스트:\n' + (data.text || 'N/A') + '\n\n' +
                        '언어: ' + (data.language || 'N/A') + '\n' +
                        '언어 감지 확률: ' + (data.language_probability ? (data.language_probability * 100).toFixed(1) + '%' : 'N/A') + '\n' +
                        '세그먼트 개수: ' + (data.segments_count || 'N/A') + '\n' +
                        '처리 시간: ' + (data.processing_time ? data.processing_time + '초' : 'N/A') + '\n';
                    
                    // 파일 정보가 있으면 추가
                    if (data.file_info) {
                        resultText += '\n파일 정보:\n';
                        resultText += '   파일명: ' + (data.file_info.filename || 'N/A') + '\n';
                        resultText += '   타입: ' + (data.file_info.content_type || 'N/A') + '\n';
                        if (data.file_info.size) {
                            const sizeMB = (data.file_info.size / (1024 * 1024)).toFixed(2);
                            resultText += '   크기: ' + sizeMB + ' MB\n';
                        }
                    }
                    
                    document.getElementById('result').textContent = resultText;
                }
            })
            .catch(error => {
                document.getElementById('result').textContent = '오류: ' + error.message;
            });
        }
        
        function transcribeByPath() {
            const filePath = document.getElementById('filePath').value;
            
            if (!filePath) {
                alert('파일 경로를 입력하세요.');
                return;
            }
            
            document.getElementById('result').textContent = '변환 중...';
            
            const formData = new FormData();
            formData.append('file_path', filePath);
            
            fetch('/transcribe', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('result').textContent = '오류: ' + data.error;
                } else {
                    let resultText = 
                        '변환 결과\n' +
                        '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n' +
                        '텍스트:\n' + (data.text || 'N/A') + '\n\n' +
                        '언어: ' + (data.language || 'N/A') + '\n' +
                        '언어 감지 확률: ' + (data.language_probability ? (data.language_probability * 100).toFixed(1) + '%' : 'N/A') + '\n' +
                        '세그먼트 개수: ' + (data.segments_count || 'N/A') + '\n' +
                        '처리 시간: ' + (data.processing_time ? data.processing_time + '초' : 'N/A') + '\n';
                    
                    // 파일 정보가 있으면 추가
                    if (data.file_info) {
                        resultText += '\n파일 정보:\n';
                        resultText += '   파일명: ' + (data.file_info.filename || 'N/A') + '\n';
                        resultText += '   타입: ' + (data.file_info.content_type || 'N/A') + '\n';
                        if (data.file_info.size) {
                            const sizeMB = (data.file_info.size / (1024 * 1024)).toFixed(2);
                            resultText += '   크기: ' + sizeMB + ' MB\n';
                        }
                    }
                    
                    document.getElementById('result').textContent = resultText;
                }
            })
            .catch(error => {
                document.getElementById('result').textContent = '오류: ' + error.message;
            });
        }
        
        function getServiceInfo() {
            const statusDiv = document.getElementById('serverStatus');
            statusDiv.textContent = '서비스 정보 조회 중...';
            
            fetch('http://localhost:7920/api/v1/info')
                .then(response => response.json())
                .then(data => {
                    let infoText = 
                        '서비스 정보\n' +
                        '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n' +
                        '서비스: ' + (data.service || 'N/A') + '\n' +
                        '버전: ' + (data.version || 'N/A') + '\n' +
                        '모델: ' + (data.model || 'N/A') + '\n' +
                        '디바이스: ' + (data.device || 'N/A') + '\n' +
                        '지원 형식: ' + (data.supported_formats ? data.supported_formats.join(', ') : 'N/A') + '\n' +
                        '최대 파일 크기: ' + (data.max_file_size_mb || 'N/A') + ' MB\n';
                    
                    if (data.features && data.features.length > 0) {
                        infoText += '기능: ' + data.features.join(', ') + '\n';
                    }
                    
                    statusDiv.textContent = infoText;
                    statusDiv.className = 'status success';
                })
                .catch(error => {
                    statusDiv.textContent = '서비스 정보 조회 실패\n   오류: ' + error.message;
                    statusDiv.className = 'status error';
                });
        }
        
        // 페이지 로드 시 서버 상태 확인
        window.onload = function() {
            checkServer();
        };
    </script>
</body>
</html> 